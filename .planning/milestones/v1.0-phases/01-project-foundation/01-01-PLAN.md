---
phase: 01-project-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - SimpleLab/SimpleLab.psm1
  - SimpleLab/SimpleLab.psd1
  - SimpleLab/Public/Test-HyperVEnabled.ps1
  - SimpleLab/Private/Get-HostInfo.ps1
  - SimpleLab/Private/Write-RunArtifact.ps1
autonomous: true

must_haves:
  truths:
    - "SimpleLab directory exists at repository root with Public/ and Private/ subdirectories"
    - "SimpleLab.psm1 module file exists with Export-ModuleMember declarations"
    - "SimpleLab.psd1 manifest file exists with module metadata"
    - "All stub function files exist (Test-HyperVEnabled, Get-HostInfo, Write-RunArtifact)"
    - "Module can be imported with Import-Module ./SimpleLab/SimpleLab.psd1 without errors"
  artifacts:
    - path: "SimpleLab/SimpleLab.psm1"
      provides: "Root module file that loads Public and Private functions"
      min_lines: 20
      contains: "Export-ModuleMember"
    - path: "SimpleLab/SimpleLab.psd1"
      provides: "Module manifest with metadata and exports"
      contains: "ModuleVersion", "FunctionsToExport"
    - path: "SimpleLab/Public/"
      provides: "Public API functions directory"
      min_files: 1
    - path: "SimpleLab/Private/"
      provides: "Internal helper functions directory"
      min_files: 2
    - path: "SimpleLab/Public/Test-HyperVEnabled.ps1"
      provides: "Hyper-V detection function stub"
      contains: "function Test-HyperVEnabled"
    - path: "SimpleLab/Private/Get-HostInfo.ps1"
      provides: "Host information collection stub"
      contains: "function Get-HostInfo"
    - path: "SimpleLab/Private/Write-RunArtifact.ps1"
      provides: "Run artifact generation stub"
      contains: "function Write-RunArtifact"
  key_links:
    - from: "SimpleLab/SimpleLab.psm1"
      to: "SimpleLab/Public/*.ps1"
      via: "Dot-sourcing pattern with Get-ChildItem and foreach"
      pattern: "Get-ChildItem.*Public.*\\.ps1"
    - from: "SimpleLab/SimpleLab.psm1"
      to: "SimpleLab/Private/*.ps1"
      via: "Dot-sourcing pattern with Get-ChildItem and foreach"
      pattern: "Get-ChildItem.*Private.*\\.ps1"
    - from: "SimpleLab/SimpleLab.psm1"
      to: "SimpleLab/SimpleLab.psd1"
      via: "Module manifest referenced in psd1"
      pattern: "Export-ModuleMember"
---

<objective>
Create the SimpleLab module structure with directories, module files, and stub functions. This establishes the foundation for all subsequent Phase 1 work.

Purpose: Provide organized module structure following PowerShell best practices with Public/Private function separation.
Output: SimpleLab/ directory with .psm1, .psd1, Public/, and Private/ folders containing stub functions.
</objective>

<execution_context>
@/home/ajt/.claude/get-shit-done/workflows/execute-plan.md
@/home/ajt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-foundation/01-CONTEXT.md
@.planning/phases/01-project-foundation/01-RESEARCH.md

# Existing patterns from codebase (for reference, not to copy)
Lab-Common.ps1 - Shows function definitions with param blocks and error handling
Deploy.ps1 - Shows script-level organization with $ErrorActionPreference = 'Stop'
</context>

<tasks>

<task type="auto">
  <name>Create SimpleLab directory structure</name>
  <files>SimpleLab/</files>
  <action>
Create the following directory structure at repository root:
```
SimpleLab/
├── SimpleLab.psm1          # Root module file
├── SimpleLab.psd1          # Module manifest
├── Public/                 # User-facing functions
│   └── Test-HyperVEnabled.ps1
└── Private/                # Internal helper functions
    ├── Get-HostInfo.ps1
    └── Write-RunArtifact.ps1
```

DO NOT create additional subdirectories (Classes/, etc.) - only the structure above per user decision.

Use mkdir/New-Item commands. Ensure directories are created before writing files.
  </action>
  <verify>Test-Path SimpleLab/Public returns $true; Test-Path SimpleLab/Private returns $true</verify>
  <done>Directory structure exists with Public/ and Private/ subfolders</done>
</task>

<task type="auto">
  <name>Create SimpleLab.psm1 root module file</name>
  <files>SimpleLab/SimpleLab.psm1</files>
  <action>
Create SimpleLab.psm1 with the standard PowerShell module pattern:

```powershell
# SimpleLab.psm1
# SimpleLab Module - Streamlined Windows domain lab automation

Set-StrictMode -Version Latest
$ErrorActionPreference = 'Stop'

# Dot-source private functions
$PrivateFunctions = Get-ChildItem -Path "$PSScriptRoot\Private\*.ps1" -ErrorAction SilentlyContinue
foreach ($file in $PrivateFunctions) {
    try {
        . $file.FullName
    }
    catch {
        Write-Error "Failed to import function $($file.BaseName): $_"
        throw
    }
}

# Dot-source public functions
$PublicFunctions = Get-ChildItem -Path "$PSScriptRoot\Public\*.ps1" -ErrorAction SilentlyContinue
foreach ($file in $PublicFunctions) {
    try {
        . $file.FullName
    }
    catch {
        Write-Error "Failed to import function $($file.BaseName): $_"
        throw
    }
}

# Export public functions explicitly
Export-ModuleMember -Function @(
    'Test-HyperVEnabled'
)
```

This follows the Microsoft pattern from RESEARCH.md (Pattern 4: Module Import and Export).
  </action>
  <verify>Get-Module SimpleLab -ListAvailable returns module info with ExportedFunctions containing Test-HyperVEnabled</verify>
  <done>Module file exists with proper dot-sourcing and Export-ModuleMember</done>
</task>

<task type="auto">
  <name>Create SimpleLab.psd1 module manifest</name>
  <files>SimpleLab/SimpleLab.psd1</files>
  <action>
Create SimpleLab.psd1 module manifest using New-ModuleManifest command pattern. Include:

- ModuleVersion: '0.1.0'
- Author: 'SimpleLab'
- Description: 'Streamlined Windows domain lab automation'
- PowerShellVersion: '5.1'
- FunctionsToExport: @('Test-HyperVEnabled')
- PrivateData: PSData with Tags, ProjectURI, LicenseURI

Use New-ModuleManifest cmdlet or create file directly. Ensure proper PowerShell manifest syntax.

Reference RESEARCH.md "Pattern 4: Module Import and Export" for manifest structure.
  </action>
  <verify>Test-ModuleManifest SimpleLab/SimpleLab.psd1 returns True with no errors</verify>
  <done>Module manifest passes Test-ModuleManifest validation</done>
</task>

<task type="auto">
  <name>Create Test-HyperVEnabled.ps1 stub function</name>
  <files>SimpleLab/Public/Test-HyperVEnabled.ps1</files>
  <action>
Create Public/Test-HyperVEnabled.ps1 with a stub function:

```powershell
function Test-HyperVEnabled {
    [CmdletBinding()]
    param()

    # TODO: Implement Hyper-V detection per CONTEXT.md decision
    # Use Get-ComputerInfo to check Hyper-V status
    # Check on every operation (not lazy evaluation)
    # When Hyper-V is not enabled: Offer to enable with full command syntax
    # Error message format: "Hyper-V is not enabled. Run: Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All"

    Write-Warning "Test-HyperVEnabled: Not yet implemented"
    return $false
}
```

This is a STUB only. Full implementation comes in Plan 01-02.
  </action>
  <verify>Get-Command Test-HyperVEnabled -Module SimpleLab returns command info</verify>
  <done>Function is exported and callable from module</done>
</task>

<task type="auto">
  <name>Create Get-HostInfo.ps1 and Write-RunArtifact.ps1 stub functions</name>
  <files>SimpleLab/Private/Get-HostInfo.ps1</files>
  <action>
Create Private/Get-HostInfo.ps1 with stub:

```powershell
function Get-HostInfo {
    [CmdletBinding()]
    param()

    # TODO: Return host information for run artifacts
    # Fields: ComputerName, Username, PowerShellVersion

    return @{
        ComputerName = $env:COMPUTERNAME
        Username = $env:USERNAME
        PowerShellVersion = $PSVersionTable.PSVersion.ToString()
    }
}
```

Create Private/Write-RunArtifact.ps1 with stub:

```powershell
function Write-RunArtifact {
    [CmdletBinding()]
    param(
        [string]$Operation,
        [string]$Status,
        [double]$Duration,
        [int]$ExitCode,
        [string[]]$VMNames = @(),
        [string]$Phase = "01-project-foundation",
        [Management.Automation.ErrorRecord]$ErrorRecord
    )

    # TODO: Implement JSON artifact generation per CONTEXT.md decision
    # Store as timestamped files (one per run): run-YYYYMMDD-HHMMSS.json
    # Location: .planning/runs/ directory
    # Fields: Operation, Timestamp, Status, Duration, Error (if any), VM names, Phase info, Host info

    Write-Warning "Write-RunArtifact: Not yet implemented"
}
```

These are STUBS only. Full implementation comes in Plan 01-03.
  </action>
  <verify>Get-Command Get-HostInfo -Module SimpleLab fails (function is private, not exported); calling Get-HostInfo from within module returns hashtable</verify>
  <done>Private functions exist and are callable from within module scope</done>
</task>

</tasks>

<verification>
1. Import module: `Import-Module ./SimpleLab/SimpleLab.psd1` succeeds without errors
2. Test export: `Get-Command -Module SimpleLab` shows Test-HyperVEnabled as exported
3. Test stub: `Test-HyperVEnabled` returns warning and $false
4. Verify structure: `dir SimpleLab/Public` and `dir SimpleLab/Private` show expected files
</verification>

<success_criteria>
1. SimpleLab directory exists at repository root with Public/ and Private/ subdirectories
2. Module can be imported with Import-Module without errors
3. Test-HyperVEnabled function is exported and callable
4. Private functions exist but are not exported (internal only)
5. Module manifest passes Test-ModuleManifest validation
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-01-SUMMARY.md` with:
- Actual files created with line counts
- Module import test results
- Any deviations from plan
- Next steps for Plan 01-02
</output>
