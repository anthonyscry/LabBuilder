---
phase: 10-module-diagnostics
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - Deploy.ps1
  - Bootstrap.ps1
  - LabBuilder/Build-LabFromSelection.ps1
  - LabBuilder/Roles/DHCP.ps1
  - LabBuilder/Roles/DSCPullServer.ps1
  - LabBuilder/Roles/FileServer.ps1
  - LabBuilder/Roles/IIS.ps1
  - LabBuilder/Roles/Jumpbox.ps1
  - LabBuilder/Roles/LinuxRoleBase.ps1
  - LabBuilder/Roles/PrintServer.ps1
  - LabBuilder/Roles/WSUS.ps1
  - Scripts/Add-LIN1.ps1
  - Scripts/Asset-Report.ps1
  - Scripts/Build-OfflineAutomatedLabBundle.ps1
  - Scripts/Configure-LIN1.ps1
  - Scripts/Install-Ansible.ps1
  - Scripts/New-LabProject.ps1
  - Scripts/Push-ToWS1.ps1
  - Scripts/Run-OpenCodeLab.ps1
  - Scripts/Save-LabWork.ps1
  - Scripts/Test-OpenCodeLabHealth.ps1
autonomous: true
requirements:
  - DIAG-01

must_haves:
  truths:
    - "Deploy.ps1 has zero Out-Null pipe patterns except intentional 2>&1 suppressions"
    - "Bootstrap.ps1 has zero Out-Null pipe patterns except intentional 2>&1 suppressions"
    - "All LabBuilder role scripts use context-appropriate patterns instead of Out-Null"
    - "All Scripts/*.ps1 files use context-appropriate patterns instead of Out-Null"
    - "External process suppression (2>&1 | Out-Null) patterns are preserved unchanged"
  artifacts:
    - path: "Deploy.ps1"
      provides: "Deployment script with diagnostic visibility"
      contains: "Write-Verbose"
    - path: "Bootstrap.ps1"
      provides: "Bootstrap script with diagnostic visibility"
      contains: "Write-Verbose"
    - path: "LabBuilder/Build-LabFromSelection.ps1"
      provides: "Lab builder with diagnostic visibility"
  key_links:
    - from: "Deploy.ps1"
      to: "diagnostic output"
      via: "Write-Verbose replacing Out-Null on cmdlet calls"
      pattern: "Write-Verbose"
    - from: "LabBuilder/Roles/*.ps1"
      to: "diagnostic output"
      via: "Write-Verbose or [void] replacing Out-Null"
      pattern: "(Write-Verbose|\\[void\\])"
---

<objective>
Replace all ~108 Out-Null instances across Deploy.ps1, Bootstrap.ps1, LabBuilder/, and Scripts/ files with context-appropriate patterns.

Purpose: Surface diagnostic output via -Verbose in deployment, bootstrap, role provisioning, and utility scripts.
Output: Updated infrastructure and utility files with zero unintentional Out-Null remaining.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-module-diagnostics/10-CONTEXT.md
@Deploy.ps1
@Bootstrap.ps1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Out-Null in Deploy.ps1 and Bootstrap.ps1 (56 instances)</name>
  <files>Deploy.ps1, Bootstrap.ps1</files>
  <action>
**Deploy.ps1 (50 instances):**
This is the largest single file. Read the file and categorize each Out-Null instance:

- **New-Item directory creation** (likely ~20+ instances): `New-Item -Path $dir -ItemType Directory | Out-Null` → `$null = New-Item -Path $dir -ItemType Directory` with `Write-Verbose "Created directory: $dir"` on next line
- **Hyper-V cmdlet output** (Set-VM, Set-VMProcessor, Set-VMMemory, Add-VMHardDiskDrive, Add-VMNetworkAdapter, Set-VMNetworkAdapter, etc.): `Set-VM ... | Out-Null` → `Write-Verbose "Configuring VM $vmName..."` before the call, `$null = Set-VM ...`
- **Import-Module calls**: `Import-Module ... | Out-Null` → `$null = Import-Module ...` with `Write-Verbose "Imported module: $moduleName"`
- **.NET method calls** (.Add(), .Remove(), etc.): Use `[void]` prefix
- **Invoke-Command blocks**: `Invoke-Command ... | Out-Null` → `$null = Invoke-Command ...` with `Write-Verbose "Executed remote command on $computerName"`
- **External process suppression** (`2>&1 | Out-Null`): LEAVE AS-IS. These intentionally discard stderr+stdout from external executables.
- **Copy-Item, Move-Item**: `Copy-Item ... | Out-Null` → `$null = Copy-Item ...` with `Write-Verbose "Copied $source to $dest"`

For Write-Verbose messages in Deploy.ps1, use descriptive messages that include the VM name or resource being configured. Example: `Write-Verbose "Set VM '$VMName' processor count to $ProcessorCount"`.

Group related Hyper-V configuration lines under a single Write-Verbose when they configure the same VM in sequence. Example: one `Write-Verbose "Configuring hardware for VM '$VMName'..."` before a block of Set-VM* calls, rather than one per line.

**Bootstrap.ps1 (6 instances):**
Likely New-Item directory creation and Import-Module calls. Apply same patterns as Deploy.ps1.
  </action>
  <verify>Run `grep -c "Out-Null" Deploy.ps1` and check that the count reflects only intentional `2>&1 | Out-Null` patterns (external processes). Run `grep "Out-Null" Deploy.ps1` to verify remaining instances are all `2>&1 | Out-Null`. Run `grep -c "Out-Null" Bootstrap.ps1` and confirm 0.</verify>
  <done>Deploy.ps1 has only intentional 2>&1 Out-Null remaining. Bootstrap.ps1 has zero Out-Null. All other instances replaced with context-appropriate patterns.</done>
</task>

<task type="auto">
  <name>Task 2: Replace Out-Null in LabBuilder/ and Scripts/ files (52 instances across 19 files)</name>
  <files>
LabBuilder/Build-LabFromSelection.ps1
LabBuilder/Roles/DHCP.ps1
LabBuilder/Roles/DSCPullServer.ps1
LabBuilder/Roles/FileServer.ps1
LabBuilder/Roles/IIS.ps1
LabBuilder/Roles/Jumpbox.ps1
LabBuilder/Roles/LinuxRoleBase.ps1
LabBuilder/Roles/PrintServer.ps1
LabBuilder/Roles/WSUS.ps1
Scripts/Add-LIN1.ps1
Scripts/Asset-Report.ps1
Scripts/Build-OfflineAutomatedLabBundle.ps1
Scripts/Configure-LIN1.ps1
Scripts/Install-Ansible.ps1
Scripts/New-LabProject.ps1
Scripts/Push-ToWS1.ps1
Scripts/Run-OpenCodeLab.ps1
Scripts/Save-LabWork.ps1
Scripts/Test-OpenCodeLabHealth.ps1
  </files>
  <action>
Apply context-aware replacement to all LabBuilder/ and Scripts/ files.

**LabBuilder/Build-LabFromSelection.ps1 (7 instances):**
Likely .NET List.Add() calls for VM tracking and New-Item calls. Use [void] for .NET, $null = with Write-Verbose for cmdlets.

**LabBuilder/Roles/*.ps1 files (combined ~22 instances):**
Role scripts use Out-Null for:
- Windows feature installation: `Install-WindowsFeature ... | Out-Null` → `Write-Verbose "Installing Windows feature: $featureName"` then `$null = Install-WindowsFeature ...`
- Service configuration: `Set-Service ... | Out-Null` → `$null = Set-Service ...` with Write-Verbose
- New-Item directory creation → `$null = New-Item ...` with Write-Verbose
- Invoke-Command remote execution → `$null = Invoke-Command ...` with Write-Verbose
- `2>&1 | Out-Null` external process → LEAVE AS-IS

**Scripts/*.ps1 files (combined ~21 instances):**
Utility scripts likely have:
- New-Item file/directory creation → `$null = New-Item ...` with Write-Verbose
- Copy-Item operations → `$null = Copy-Item ...` with Write-Verbose
- Import-Module → `$null = Import-Module ...` with Write-Verbose
- .NET method calls → `[void]` prefix
- `2>&1 | Out-Null` → LEAVE AS-IS

For Scripts/ files, Write-Verbose messages should reference the script's purpose. Example in Asset-Report.ps1: `Write-Verbose "Created report directory: $reportPath"`.

After all replacements, do a final sweep of all modified files to confirm no accidental Out-Null remains (except intentional 2>&1 patterns).
  </action>
  <verify>Run `grep -rl "Out-Null" LabBuilder/ Scripts/ --include="*.ps1" | sort` and verify any remaining files only contain `2>&1 | Out-Null` patterns. Run existing Pester tests to confirm no regressions.</verify>
  <done>All LabBuilder/ and Scripts/ files have Out-Null replaced with context-appropriate patterns. Only intentional 2>&1 suppressions remain. All existing tests pass.</done>
</task>

</tasks>

<verification>
1. `grep -rn "| Out-Null" Deploy.ps1 Bootstrap.ps1 LabBuilder/ Scripts/ --include="*.ps1"` — remaining matches are ALL `2>&1 | Out-Null` patterns (external process suppression)
2. `grep -c "Write-Verbose" Deploy.ps1` shows significant increase from baseline
3. All LabBuilder/Roles/*.ps1 files have Write-Verbose for feature installation and configuration
4. All existing Pester tests pass without regression
</verification>

<success_criteria>
- Zero unintentional Out-Null remaining in Deploy.ps1, Bootstrap.ps1, LabBuilder/, Scripts/
- Only `2>&1 | Out-Null` patterns preserved (external process suppression)
- Cmdlet operations surfaced via Write-Verbose
- .NET method calls use [void] cast
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-module-diagnostics/10-03-SUMMARY.md`
</output>
