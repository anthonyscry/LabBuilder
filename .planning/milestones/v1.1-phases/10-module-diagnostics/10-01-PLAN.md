---
phase: 10-module-diagnostics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - GUI/Start-OpenCodeLabGUI.ps1
  - SimpleLab.psm1
  - SimpleLab.psd1
  - Tests/ModuleDiagnostics.Tests.ps1
autonomous: true
requirements:
  - DIAG-02
  - DIAG-03

must_haves:
  truths:
    - "GUI Out-Null instances are all replaced with [void] cast pattern"
    - "SimpleLab.psm1 Export-ModuleMember has no ghost function names"
    - "SimpleLab.psd1 FunctionsToExport matches actual Public/ function count exactly"
    - "SimpleLab.psm1 and SimpleLab.psd1 export lists are identical"
    - "Module loads without warnings about missing or extra exported functions"
  artifacts:
    - path: "GUI/Start-OpenCodeLabGUI.ps1"
      provides: "GUI with [void] cast instead of Out-Null"
      contains: "[void]"
    - path: "SimpleLab.psm1"
      provides: "Module with clean export list"
      exports: ["Export-ModuleMember"]
    - path: "SimpleLab.psd1"
      provides: "Module manifest with accurate FunctionsToExport"
      contains: "FunctionsToExport"
    - path: "Tests/ModuleDiagnostics.Tests.ps1"
      provides: "Regression tests for module exports and Out-Null removal"
      min_lines: 40
  key_links:
    - from: "SimpleLab.psm1"
      to: "SimpleLab.psd1"
      via: "Export-ModuleMember list must match FunctionsToExport"
      pattern: "Export-ModuleMember"
    - from: "SimpleLab.psd1"
      to: "Public/*.ps1"
      via: "FunctionsToExport must match actual Public/ function files"
      pattern: "FunctionsToExport"
---

<objective>
Convert all 50 GUI Out-Null instances to [void] cast pattern, reconcile module export lists by removing 3 ghost functions and syncing SimpleLab.psd1 with SimpleLab.psm1, and add regression tests.

Purpose: Clean up GUI pipeline overhead and ensure module exports accurately reflect actual Public/ functions with no dead entries.
Output: Updated GUI file, synchronized module manifests, regression test file.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-module-diagnostics/10-CONTEXT.md
@GUI/Start-OpenCodeLabGUI.ps1
@SimpleLab.psm1
@SimpleLab.psd1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert GUI Out-Null to [void] cast</name>
  <files>GUI/Start-OpenCodeLabGUI.ps1</files>
  <action>
Replace all 50 `| Out-Null` instances in GUI/Start-OpenCodeLabGUI.ps1 with `[void]` cast pattern per user decision.

Transformation rules:
- `$collection.Add($item) | Out-Null` becomes `[void]$collection.Add($item)`
- `$window.ShowDialog() | Out-Null` becomes `[void]$window.ShowDialog()`
- Any `.Add()`, `.Remove()`, `.Insert()` method call piped to Out-Null becomes `[void]` prefixed
- Any WPF method call piped to Out-Null becomes `[void]` prefixed
- Pattern: remove ` | Out-Null` from end, prepend `[void]` before the expression

Do NOT change any `2>&1 | Out-Null` patterns (external process suppression) if any exist in this file.
Do NOT change any `Read-Host | Out-Null` patterns if any exist.

After replacement, verify zero `| Out-Null` remain in the file (search for the literal string).
  </action>
  <verify>Run `grep -c "Out-Null" GUI/Start-OpenCodeLabGUI.ps1` and confirm result is 0. Run `grep -c "\[void\]" GUI/Start-OpenCodeLabGUI.ps1` and confirm count is approximately 50.</verify>
  <done>All 50 GUI Out-Null instances replaced with [void] cast. Zero Out-Null remaining in GUI file.</done>
</task>

<task type="auto">
  <name>Task 2: Reconcile module export lists</name>
  <files>SimpleLab.psm1, SimpleLab.psd1</files>
  <action>
**Step 1: Remove 3 ghost functions from SimpleLab.psm1**

Remove these 3 entries from the Export-ModuleMember list in SimpleLab.psm1 (they have no source files):
- `Test-LabCleanup`
- `Test-LabPrereqs`
- `Write-ValidationReport`

**Step 2: Build canonical export list**

The canonical list is derived from actual Public/ files. There are 35 top-level Public/*.ps1 files and 12 Public/Linux/*.ps1 files = 47 total functions.

Top-level Public/ (35):
Connect-LabVM, Get-LabCheckpoint, Get-LabStatus, Initialize-LabDNS, Initialize-LabDomain, Initialize-LabNetwork, Initialize-LabVMs, Join-LabDomain, New-LabNAT, New-LabSSHKey, New-LabSwitch, New-LabVM, Remove-LabSwitch, Remove-LabVM, Remove-LabVMs, Reset-Lab, Restart-LabVM, Restart-LabVMs, Restore-LabCheckpoint, Resume-LabVM, Save-LabCheckpoint, Save-LabReadyCheckpoint, Show-LabStatus, Start-LabVMs, Stop-LabVMs, Suspend-LabVM, Suspend-LabVMs, Test-HyperVEnabled, Test-LabDomainHealth, Test-LabIso, Test-LabNetwork, Test-LabNetworkHealth, Wait-LabVMReady, Write-LabStatus, Write-RunArtifact

Public/Linux/ (12):
Add-LinuxDhcpReservation, Finalize-LinuxInstallMedia, Get-LinuxSSHConnectionInfo, Get-LinuxVMIPv4, Get-Sha512PasswordHash, Invoke-BashOnLinuxVM, Join-LinuxToDomain, New-CidataVhdx, New-LinuxGoldenVhdx, New-LinuxVM, Remove-HyperVVMStale, Wait-LinuxVMReady

**Step 3: Update SimpleLab.psm1 Export-ModuleMember**

Replace the Export-ModuleMember function list with the canonical 47-function list. Keep the comment groupings (VM management, Linux VM helpers, UX helpers). Alphabetical within each group.

**Step 4: Update SimpleLab.psd1 FunctionsToExport**

Replace the FunctionsToExport array with the exact same canonical 47-function list, same ordering and comment groupings as psm1.

**Verification:** Both files must have identical function name lists. No ghost functions. Count must be exactly 47.
  </action>
  <verify>Run `grep -c "'" SimpleLab.psm1 | head -5` in the Export-ModuleMember block and `grep -c "'" SimpleLab.psd1` in FunctionsToExport block to verify 47 entries each. Diff the two lists to confirm they match exactly.</verify>
  <done>SimpleLab.psm1 and SimpleLab.psd1 both export exactly 47 functions matching actual Public/ files. Ghost functions Test-LabCleanup, Test-LabPrereqs, Write-ValidationReport removed.</done>
</task>

<task type="auto">
  <name>Task 3: Add module diagnostics regression tests</name>
  <files>Tests/ModuleDiagnostics.Tests.ps1</files>
  <action>
Create Tests/ModuleDiagnostics.Tests.ps1 with Pester 5.x tests:

**Describe "Module Export Consistency":**
- It "SimpleLab.psd1 FunctionsToExport matches SimpleLab.psm1 Export-ModuleMember" — Parse both files, extract function name arrays, compare with `Compare-Object`. Expect no differences.
- It "Every Public/*.ps1 file has a matching export entry" — Get all .ps1 filenames from Public/ and Public/Linux/ (basename without extension = function name), verify each exists in the psd1 FunctionsToExport list.
- It "No ghost functions in export list" — Verify no exported function name lacks a corresponding Public/*.ps1 or Public/Linux/*.ps1 file.
- It "Export count matches Public/ file count" — Count Public/ .ps1 files (including Linux/), compare to FunctionsToExport count.

**Describe "GUI Out-Null Removal":**
- It "GUI file contains no Out-Null pipe patterns" — Read GUI/Start-OpenCodeLabGUI.ps1 content, assert zero matches for `\| *Out-Null`.
- It "GUI file uses [void] cast pattern" — Assert `[void]` appears at least 40 times in GUI file.

Test pattern: Use `$repoRoot = Split-Path -Parent $PSScriptRoot` in BeforeAll. Parse files with `Get-Content` and regex, not module import (avoid Hyper-V dependency). Use `-match` and `Select-String` for pattern detection.

For parsing psd1 FunctionsToExport: Read file content, extract the FunctionsToExport block via regex, then extract quoted function names.
For parsing psm1 Export-ModuleMember: Read file content, find Export-ModuleMember block, extract quoted function names.
  </action>
  <verify>Run `pwsh -Command "Invoke-Pester Tests/ModuleDiagnostics.Tests.ps1 -PassThru" 2>&1 | tail -20` and confirm all tests pass.</verify>
  <done>All module diagnostics regression tests pass. Tests verify export consistency, no ghost functions, GUI [void] pattern, and export count matches Public/ file count.</done>
</task>

</tasks>

<verification>
1. `grep -c "Out-Null" GUI/Start-OpenCodeLabGUI.ps1` returns 0
2. `grep "Test-LabCleanup\|Test-LabPrereqs\|Write-ValidationReport" SimpleLab.psm1 SimpleLab.psd1` returns no matches
3. Export-ModuleMember in psm1 and FunctionsToExport in psd1 have identical 47-function lists
4. All existing tests still pass: `pwsh -Command "Invoke-Pester Tests/ -PassThru"`
5. New ModuleDiagnostics.Tests.ps1 passes
</verification>

<success_criteria>
- Zero Out-Null in GUI file, replaced with [void] cast
- Ghost functions removed from both module files
- Both module files export exactly 47 functions matching Public/ files
- Regression tests pass proving export consistency and GUI cleanup
</success_criteria>

<output>
After completion, create `.planning/phases/10-module-diagnostics/10-01-SUMMARY.md`
</output>
