---
phase: 10-module-diagnostics
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Private/Add-LabRunEvent.ps1
  - Private/Ensure-VMsReady.ps1
  - Private/Get-LabRunArtifactSummary.ps1
  - Private/Import-LabModule.ps1
  - Private/Import-OpenCodeLab.ps1
  - Private/Initialize-LabConfig.ps1
  - Private/Invoke-LabAddVMWizard.ps1
  - Private/Invoke-LabBlowAway.ps1
  - Private/Invoke-LabBulkVMProvision.ps1
  - Private/Linux/Copy-LinuxFile.ps1
  - Private/Linux/Invoke-LinuxSSH.ps1
  - Private/New-LabAppArgumentList.ps1
  - Private/New-LabDeploymentReport.ps1
  - Private/Remove-StaleVM.ps1
  - Private/Save-LabTemplate.ps1
  - Private/Set-LabVMUnattend.ps1
  - Private/Stop-LabVMsSafe.ps1
  - Private/Suspend-LabMenuPrompt.ps1
  - Private/Write-LabRunArtifacts.ps1
  - Public/Get-LabStatus.ps1
  - Public/Initialize-LabDNS.ps1
  - Public/Initialize-LabVMs.ps1
  - Public/Join-LabDomain.ps1
  - Public/Linux/New-CidataVhdx.ps1
  - Public/Linux/New-LinuxGoldenVhdx.ps1
  - Public/Linux/New-LinuxVM.ps1
  - Public/Linux/Remove-HyperVVMStale.ps1
  - Public/New-LabSSHKey.ps1
  - Public/New-LabVM.ps1
  - Public/Restart-LabVM.ps1
  - Public/Restore-LabCheckpoint.ps1
  - Public/Save-LabCheckpoint.ps1
  - Public/Start-LabVMs.ps1
  - Public/Stop-LabVMs.ps1
autonomous: true
requirements:
  - DIAG-01

must_haves:
  truths:
    - "Private/ and Public/ files have zero Out-Null pipe patterns in operational code"
    - "Each replacement uses the context-appropriate pattern per decision table"
    - ".NET method return values use [void] cast, not Write-Verbose"
    - "Cmdlet output suppressions use Write-Verbose or $null = pattern"
    - "External process suppressions (2>&1) are left as-is"
  artifacts:
    - path: "Private/New-LabAppArgumentList.ps1"
      provides: "Highest-count Private file with context-aware replacements"
      contains: "[void]"
    - path: "Public/Get-LabStatus.ps1"
      provides: "Highest-count Public file with context-aware replacements"
  key_links:
    - from: "Private/*.ps1"
      to: "diagnostic output"
      via: "Write-Verbose replacing Out-Null on cmdlet calls"
      pattern: "Write-Verbose"
    - from: "Public/*.ps1"
      to: "diagnostic output"
      via: "Write-Verbose or [void] replacing Out-Null"
      pattern: "(Write-Verbose|\\[void\\])"
---

<objective>
Replace all ~68 Out-Null instances across 34 Private/ and Public/ files with context-appropriate patterns: Write-Verbose for cmdlet output suppression, [void] for .NET return values, $null = where appropriate.

Purpose: Surface diagnostic output via -Verbose in module operational paths while properly suppressing .NET return values.
Output: Updated Private/ and Public/ files with zero Out-Null remaining.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-module-diagnostics/10-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Out-Null in Private/ files (19 files, ~46 instances)</name>
  <files>
Private/Add-LabRunEvent.ps1
Private/Ensure-VMsReady.ps1
Private/Get-LabRunArtifactSummary.ps1
Private/Import-LabModule.ps1
Private/Import-OpenCodeLab.ps1
Private/Initialize-LabConfig.ps1
Private/Invoke-LabAddVMWizard.ps1
Private/Invoke-LabBlowAway.ps1
Private/Invoke-LabBulkVMProvision.ps1
Private/Linux/Copy-LinuxFile.ps1
Private/Linux/Invoke-LinuxSSH.ps1
Private/New-LabAppArgumentList.ps1
Private/New-LabDeploymentReport.ps1
Private/Remove-StaleVM.ps1
Private/Save-LabTemplate.ps1
Private/Set-LabVMUnattend.ps1
Private/Stop-LabVMsSafe.ps1
Private/Suspend-LabMenuPrompt.ps1
Private/Write-LabRunArtifacts.ps1
  </files>
  <action>
For each Private/ file, read the file and apply context-appropriate replacement per the decision table:

**Pattern 1 — .NET method return value suppression:**
- `$list.Add($item) | Out-Null` → `[void]$list.Add($item)`
- `$hashset.Add($x) | Out-Null` → `[void]$hashset.Add($x)`
- `$sb.AppendLine($x) | Out-Null` → `[void]$sb.AppendLine($x)`
- `[System.IO.Path]::Method() | Out-Null` → `[void][System.IO.Path]::Method()`
- `$parser.ParseFile() | Out-Null` → `[void]$parser.ParseFile()`
- Any `.Method()` call returning an index or boolean → `[void]` prefix

**Pattern 2 — Cmdlet output suppression (Hyper-V, filesystem, module):**
- `New-Item -Path ... -ItemType Directory | Out-Null` → `$null = New-Item -Path ... -ItemType Directory` AND add `Write-Verbose "Created directory: $path"` on next line
- `Import-Module ... | Out-Null` → `$null = Import-Module ...` AND add `Write-Verbose "Imported module: $moduleName"`
- `Set-VMProcessor ... | Out-Null` → `Write-Verbose "Configuring VM processor..."` before the line, then `$null = Set-VMProcessor ...`
- `Stop-VM ... | Out-Null` → `Write-Verbose "Stopping VM $vmName..."` before, then `$null = Stop-VM ...`
- `Wait-Job ... | Out-Null` → `$null = Wait-Job ...`
- `Receive-Job ... | Out-Null` → `$null = Receive-Job ...`

**Pattern 3 — External process suppression (leave as-is):**
- Any `2>&1 | Out-Null` → DO NOT CHANGE

**Pattern 4 — Read-Host suppression (leave as-is):**
- `Read-Host | Out-Null` → DO NOT CHANGE

**Key file: Private/New-LabAppArgumentList.ps1 (14 instances)**
This file has the most instances. Most are likely .NET List.Add() calls — use [void] cast pattern.

**Key file: Private/Get-LabRunArtifactSummary.ps1 (5 instances)**
Likely .NET collection adds — use [void] cast pattern.

Write-Verbose messages should be concise and descriptive: include the resource name/path being acted on. Example: `Write-Verbose "Created directory: $dirPath"` not `Write-Verbose "Directory created successfully"`.
  </action>
  <verify>Run `grep -rl "Out-Null" Private/ --include="*.ps1" | grep -v Tests` and confirm no Private/ files appear (except any with intentional 2>&1 or Read-Host patterns). Count `[void]` and `Write-Verbose` additions across modified files.</verify>
  <done>All ~46 Out-Null instances in 19 Private/ files replaced with context-appropriate patterns. Zero unintentional Out-Null remaining.</done>
</task>

<task type="auto">
  <name>Task 2: Replace Out-Null in Public/ files (15 files, ~22 instances)</name>
  <files>
Public/Get-LabStatus.ps1
Public/Initialize-LabDNS.ps1
Public/Initialize-LabVMs.ps1
Public/Join-LabDomain.ps1
Public/Linux/New-CidataVhdx.ps1
Public/Linux/New-LinuxGoldenVhdx.ps1
Public/Linux/New-LinuxVM.ps1
Public/Linux/Remove-HyperVVMStale.ps1
Public/New-LabSSHKey.ps1
Public/New-LabVM.ps1
Public/Restart-LabVM.ps1
Public/Restore-LabCheckpoint.ps1
Public/Save-LabCheckpoint.ps1
Public/Start-LabVMs.ps1
Public/Stop-LabVMs.ps1
  </files>
  <action>
Apply same context-aware replacement rules as Task 1 to all 15 Public/ files.

**Key file: Public/Get-LabStatus.ps1 (5 instances)**
Likely Hyper-V cmdlet output suppression — use `$null =` with Write-Verbose.

**Key file: Public/Linux/New-CidataVhdx.ps1 (5 instances)**
Likely filesystem New-Item calls — use `$null = New-Item ...` with `Write-Verbose "Created: $path"`.

**Key file: Public/Linux/Remove-HyperVVMStale.ps1 (4 instances)**
Hyper-V Remove-VM/Remove-Item calls — use `$null =` with Write-Verbose.

**Key file: Public/Stop-LabVMs.ps1 (3 instances)**
VM stop operations — use `Write-Verbose "Stopping VM $vmName..."` with `$null = Stop-VM ...`.

Same rules apply:
- .NET method calls → `[void]` prefix
- Cmdlet calls → `$null =` with Write-Verbose
- `2>&1 | Out-Null` → leave as-is
- `Read-Host | Out-Null` → leave as-is

Write-Verbose messages: concise, include resource identifier. Example: `Write-Verbose "Restored checkpoint '$CheckpointName' on VM '$VMName'"`.
  </action>
  <verify>Run `grep -rl "Out-Null" Public/ --include="*.ps1"` and confirm no Public/ files appear (except any with intentional 2>&1 or Read-Host patterns). Run existing Pester tests: `pwsh -Command "Invoke-Pester Tests/ -PassThru" 2>&1 | tail -5` to verify no regressions.</verify>
  <done>All ~22 Out-Null instances in 15 Public/ files replaced with context-appropriate patterns. Zero unintentional Out-Null remaining. All existing tests pass.</done>
</task>

</tasks>

<verification>
1. `grep -rl "Out-Null" Private/ Public/ --include="*.ps1"` returns empty (no matches in module code)
2. `grep -c "\[void\]" Private/*.ps1 Private/Linux/*.ps1 Public/*.ps1 Public/Linux/*.ps1 | grep -v ":0$"` shows [void] additions in files that had .NET method suppressions
3. `grep -c "Write-Verbose" Private/*.ps1 Public/*.ps1 | sort -t: -k2 -rn | head -10` shows new Write-Verbose additions
4. All existing Pester tests pass without regression
</verification>

<success_criteria>
- Zero Out-Null remaining in Private/ and Public/ operational code
- .NET method calls use [void] cast
- Cmdlet calls use $null = with Write-Verbose diagnostics
- External process and Read-Host suppressions preserved
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-module-diagnostics/10-02-SUMMARY.md`
</output>
