---
phase: 01-cleanup-config-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .archive/
  - .gitignore
autonomous: true
requirements:
  - CLN-01
  - CLN-02
  - CLN-03
  - CLN-04
  - CLN-05

must_haves:
  truths:
    - ".archive/ directory is no longer present in the working tree or git index"
    - "coverage.xml and .tools/powershell-lsp/ are in .gitignore and not tracked by git"
    - "No leftover test/debug scripts exist in the repo root"
    - "Dead or unreachable code paths have been identified and removed"
  artifacts:
    - path: ".gitignore"
      provides: "Updated ignore patterns preventing re-addition of artifacts"
      contains: ".archive/"
  key_links:
    - from: ".gitignore"
      to: "git index"
      via: "git rm + .gitignore entries"
      pattern: "\\.archive/|coverage\\.xml|\\.tools/powershell-lsp/"
---

<objective>
Remove dead code, archives, and build artifacts from the repository.

Purpose: Eliminate search noise, reduce repo size, and establish a clean baseline before config/sourcing changes. Per user decision: no reference copies, no "keep for later" -- clean cut. Git history preserves everything.

Output: Clean working tree with .archive/ deleted, artifacts untracked, .gitignore updated, dead code removed.
</objective>

<execution_context>
@/home/anthonyscry/.claude/get-shit-done/workflows/execute-plan.md
@/home/anthonyscry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cleanup-config-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete .archive/ directory and untrack build artifacts</name>
  <files>.archive/, .gitignore</files>
  <action>
1. Delete the entire `.archive/` directory from the git index and working tree:
   ```bash
   git rm -r .archive/
   ```
   This removes all tracked files under `.archive/` (SimpleLab-20260210/, deprecated-builders/, SOP-OpenCode-Dev-Lab-Slim-v3.1c.docx).

2. Verify coverage.xml and .tools/powershell-lsp/ are already untracked:
   ```bash
   git ls-files coverage.xml Tests/coverage.xml .tools/
   ```
   Research confirms they are already untracked. If any are tracked, run `git rm --cached` on them.

3. Update `.gitignore` to explicitly prevent re-addition:
   - Change the `.archive/` comment from the current passive comment to an active ignore rule
   - Current line: `# .archive/  -- kept for deprecated scripts`
   - Replace with: `.archive/`
   - Verify existing entries for `coverage.xml` (line 4) and `.tools/powershell-lsp/` (line 26) are present

4. Search for leftover test/debug scripts in repo root:
   ```bash
   ls test-*.ps1 test.json debug-*.ps1 2>/dev/null
   ```
   Research says none exist; confirm and remove any found.
  </action>
  <verify>
- `git ls-files .archive/` returns empty (no tracked files)
- `ls .archive/ 2>/dev/null` returns nothing (directory gone from working tree)
- `git ls-files coverage.xml Tests/coverage.xml .tools/` returns empty
- `grep '.archive/' .gitignore` shows the ignore rule (not commented out)
- `ls test-*.ps1 test.json debug-*.ps1 2>/dev/null` returns nothing
  </verify>
  <done>.archive/ directory deleted from working tree and git index. Build artifacts confirmed untracked. .gitignore updated to prevent re-addition. No leftover test/debug scripts in repo.</done>
</task>

<task type="auto">
  <name>Task 2: Identify and remove dead/unreachable code paths</name>
  <files>Public/Test-LabPrereqs.ps1, Public/Write-ValidationReport.ps1, Public/Test-LabCleanup.ps1, SimpleLab.psd1</files>
  <action>
1. Verify dead code candidates identified in research. For each function, grep all .ps1 files (excluding .archive/ which is now deleted) to confirm no callers:

   **Test-LabPrereqs** (Public/Test-LabPrereqs.ps1):
   ```bash
   grep -r "Test-LabPrereqs" --include="*.ps1" | grep -v "function Test-LabPrereqs" | grep -v "Tests/"
   ```
   Research says: only called by Write-ValidationReport, not by app code.

   **Write-ValidationReport** (Public/Write-ValidationReport.ps1):
   ```bash
   grep -r "Write-ValidationReport" --include="*.ps1" | grep -v "function Write-ValidationReport" | grep -v "Tests/"
   ```
   Research says: only referenced in own examples.

   **Test-LabCleanup** (Public/Test-LabCleanup.ps1):
   ```bash
   grep -r "Test-LabCleanup" --include="*.ps1" | grep -v "function Test-LabCleanup" | grep -v "Tests/"
   ```
   Research says: only referenced in own synopsis.

2. Also check for dynamic invocation patterns (splatting, Invoke-Expression, & $var):
   ```bash
   grep -r "Test-LabPrereqs\|Write-ValidationReport\|Test-LabCleanup" --include="*.ps1" --include="*.psd1"
   ```

3. Check SimpleLab.psd1 FunctionsToExport for these function names. If listed, remove them from the export list.

4. If confirmed dead (no callers outside own definition, tests, and each other):
   - Delete the 3 Public/*.ps1 files
   - Remove from SimpleLab.psd1 FunctionsToExport if present
   - Delete corresponding test files if they exist in Tests/ (only if tests are exclusively for these dead functions)

5. If any function IS called by app code (contradicting research), leave it in place and document the finding.

NOTE: Research recommends deferring this to Phase 3. However, user decision says "Delete unreachable code paths aggressively." If grep confirms no callers, delete now. If uncertain, add a comment `# REVIEW: potential dead code` and defer.
  </action>
  <verify>
- For each deleted file: `Test-Path Public/Test-LabPrereqs.ps1` returns false (or file confirmed to have callers and left in place)
- `grep -r "Test-LabPrereqs\|Write-ValidationReport\|Test-LabCleanup" --include="*.ps1" --include="*.psd1"` returns no hits outside Tests/
- If SimpleLab.psd1 was modified: `pwsh -c "Test-ModuleManifest SimpleLab.psd1"` succeeds (or `powershell -c` on Windows)
  </verify>
  <done>Dead code candidates investigated via grep. Confirmed-dead functions deleted from Public/ and removed from SimpleLab.psd1 exports. Any uncertain cases documented with REVIEW comment.</done>
</task>

</tasks>

<verification>
- `git status` shows only expected deletions (.archive/ files, dead code files) and .gitignore modification
- `git ls-files .archive/` returns empty
- No test-*.ps1 or debug-*.ps1 in repo root
- .gitignore has active `.archive/` rule
- All remaining .ps1 files still parse without errors
</verification>

<success_criteria>
1. .archive/ directory completely removed from working tree and git index
2. .gitignore prevents re-addition of .archive/, coverage.xml, .tools/powershell-lsp/
3. Dead code functions identified, confirmed via grep, and deleted (or documented if uncertain)
4. SimpleLab.psd1 updated to remove dead function exports
5. No leftover test/debug scripts in repo root
</success_criteria>

<output>
After completion, create `.planning/phases/01-cleanup-config-foundation/01-01-SUMMARY.md`
</output>
